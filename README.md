# 1. 설치

새 폴더를 만들고 주소창에 `cmd.` 입력

CMD 창이 뜨면 `npx create-next-app@latest` 입력

해당 폴더에 Next.js가 설치

마우스 우클릭을 통해 IDE로 폴더를 연다

터미털 창에서 `npm run dev` 입력

로컬 서버([http://localhost:3000](http://localhost:3000)) 실행

# 2. 배포

`npm run build`로 배포 가능한 App 생성 (.next 폴더 생성)

`npm run start`로 .next 폴더 서비스 시작

이 부분은 개발 후 진행 필요

# 3. 작업 파일

설치 후 수정할 파일은 다음과 같다.

* layout.BK : html 코드 포함
* page.js : Layout 포함 콘텐츠
* globals.css : CSS 스타일

# 4. 라우팅

## 4.1 Root
`<a href="/">Home</a>` : `/src/app`의 `layout.BK` 실행

```javascript
export const metadata = {
    title: 'Web Tutorial',
    description: 'Generated by cpk78',
}

export default function RootLayout({children}) {
    return (
        <html>
            <body>
            <h1><a href="/">Web</a></h1>
            <ol>
                <li><a href="/read/1">1.html</a></li>
                <li><a href="/read/2">2.css</a></li>
                <li><a href="/read/3">3.css</a></li>
            </ol>
            {children} {/*page.js 내용 표시*/}
            <ul>
                <li><a href="/create">Create</a></li>
                <li><a href="/update/1">Update</a></li>
                <li><input type="button" value="delete"/></li>
            </ul>
            </body>
        </html>
    )
}
```

`{children}` : `/src/app`의 `page.js` 실행

## 4.2 폴더 (File System Routing)

`<a href="/create">Create</a>` : `src/app/create`의 `layout.BK` 실행

```javascript
export default function Layout(props){
    return (
        <form>
            <h2>Create</h2>
            {props.children}
        </form>
    )
}
```
## 4.3 Dynamic Routing
`<a href="/read/1">1.html</a>` : `src/app/read/[id]`의 `page.js` 실행

```javascript
export default function Read(props) {
    return (
        <>
            <h2>Read</h2>
            parameter : {props.params.id}
        </>
    )
}
```

# 5. Single Page Application

Link Component 사용 (pre-fetching) : `a href`를 `Link href`로 변경 : 

```javascript
import './globals.css'
import Link from "next/link";

export const metadata = {
    title: 'Web Tutorial',
    description: 'Generated by cpk78',
}

export default function RootLayout({children}) {
    return (
        <html>
            <body>
                <h1><a href="/">Web</a></h1>
                <ol>
                    <li><Link href="/read/1">1.html</Link></li>
                    <li><Link href="/read/2">2.css</Link></li>
                    <li><Link href="/read/3">3.css</Link></li>
                </ol>
                {children} {/*page.js 내용 표시*/}
                <ul>
                    <li><Link href="/create">Create</Link></li>
                    <li><Link href="/update/1">Update</Link></li>
                    <li><input type="button" value="delete"/></li>
                </ul>
            </body>
        </html>
    )
}
```
# 6. Backend
## Next.js Route Handler 가이드

https://nextjs.org/docs/app/building-your-application/routing/route-handlers#convention

## JSON 서버 설치
`npx json-server --port 9999 --watch db.json`

## DB.json
```json
{
  "posts": [
    {
      "id": 1,
      "title": "json-server",
      "author": "typicode"
    }
  ],
  "comments": [
    {
      "id": 1,
      "body": "some comment",
      "postId": 1
    }
  ],
  "profile": {
    "name": "typicode"
  }
}
```
## 접속 URL
```
  http://localhost:9999/posts
  http://localhost:9999/comments
  http://localhost:9999/profile
```

## Fetch
크롬 콘솔에서 `Network` -> `Console` -> Fetch문 입력

```javascript
fetch('http://localhost:9999/topics')
  .then((resp)=>{
    return resp.json();
  })
  .then(result=>{
      console.log('result', result)
  });
```
# 7. Client-side 컴포넌트
`app/layout.BK`에 아래와 같이 입력
```javascript
export default function RootLayout({children}) {
    const [topics, setTopics] = useState([]);
    useEffect(()=>{
        fetch('http://localhost:9999/topics')
            .then(resp=>resp.json())
            .then(result=>{
                setTopics(result);
            });
    },[])
```
에러 발생 ("It only works in a Client Component")
```
./src\app\layout.BK
ReactServerComponentsError:

You're importing a component that needs useState. It only works in a Client Component but none of its parents are marked with "use client", so they're Server Components by default.
Learn more: https://nextjs.org/docs/getting-started/react-essentials
```
`app/layout.BK` 맨 위에 `"uese client"` 추가
```javascript
"use client";
import './globals.css'
import Link from "next/link";
import {useEffect, useState} from "react";
```
에러 발생 (metadata는 서버컴포넌트임)
```
./src\app\layout.BK
ReactServerComponentsError:

You are attempting to export "metadata" from a component marked with "use client", which is disallowed. Either remove the export, or the "use client" directive. Read more: https://nextjs.org/docs/getting-started/react-essentials#the-use-client-directive

   ╭─[D:\20231204-next-home\src\app\layout.BK:3:1]
 3 │ import Link from "next/link";
 4 │ import {useEffect, useState} from "react";
 5 │ 
 6 │ export const metadata = {
   ·              ────────
 7 │     title: 'Web Tutorial',
 8 │     description: 'Generated by cpk78',
 8 │ }
   ╰────

File path:
  ./src\app\layout.BK
```
Async 사용 -> 서버/클라이언트 컴포넌트 둘 다 사용 가능
```javascript
export default async function RootLayout({children}) {
    const resp = await fetch('http://localhost:9999/topics')
    const topics = await resp.json();
```
# 8. JSON 파일 읽기
db.json
```json
{
  "topics": [
    {
      "id": 1,
      "title": "html",
      "body": "html is ..."
    },
    {
      "id": 2,
      "title": "css",
      "body": "css is ..."
    }
  ],
```
src/app/read/[id]/page.js
```javascript
export default async function Read(props) {
    const resp = await fetch(`http://localhost:9999/topics/${props.params.id}`);
    const topic = await resp.json();
    return <>
        <h2>{topic.title}</h2>
        {topic.body}
    </>
}
```
# 9. 일기/생성 기능
Failed to compile 에서 발생 시
```terminal
rm rf .next
npm run dev
```
Form 생성
```javascript
"use client"
export default function Create(){
    return (
        <form onSubmit={(e)=>{
            e.preventDefault(); /*양식 실행 버튼으로 페이지 전환 막음*/
            const title = e.target.title.value;
            const body = e.target.body.value;
            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({title, body})
            }
            fetch('http://localhost:9999/topics', options)
                .then(res=>res.json())
                .then(result=>{
                    console.log(result)
                })
        }}>

            <p>
                <input type="text" name="title" placeholder="title" />
            </p>
            <p>
                <textarea name="body" placeholder="body"></textarea>
            </p>
            <p>
                <input type="submit" value="create" />
            </p>
        </form>
    )
}
```
화면에서 값 입력 시 `db.json`에 추가됨
```json
{
  "topics": [
    {
      "id": 1,
      "title": "html",
      "body": "html is ..."
    },
    {
      "id": 2,
      "title": "css",
      "body": "css is ..."
    },
    {
      "title": "javascript",
      "body": "javascript is ...",
      "id": 3
    }
  ]
}
```
현재는 Submit시 화면이 Refresh됨
```javascript
"use client"
import {useRouter} from "next/navigation"; /*next/router -> next/navigation으로 변경*/

export default function Create(){
    const router = useRouter() /*클라인트 컴포넌트에서만 사용할 수 있는 useRouter*/
    return (
        <form onSubmit={(e)=>{
            e.preventDefault(); /*양식 실행 버튼으로 페이지 전환 막음*/
            const title = e.target.title.value;
            const body = e.target.body.value;
            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({title, body})
            }
            fetch('http://localhost:9999/topics', options)
                .then(res=>res.json())
                .then(result=>{
                    console.log(result)
                    const lastid = result.id; /*마지막 화면으로 리디렉션*/
                    router.push(`/read/${lastid}`)
                })
        }}>

            <p>
                <input type="text" name="title" placeholder="title" />
            </p>
            <p>
                <textarea name="body" placeholder="body"></textarea>
            </p>
            <p>
                <input type="submit" value="create" />
            </p>
        </form>
    )
}
```

# 10. useParams API
Update 및 Delete를 해당 컨텐츠에서만 조회 필요
useParams를 통해 ID 값을 사용 가능
하지만 useParams는 Client Component임
Layout.js는 Server Component로 적용 불가
아래 부분만 별도 Function으로 생성 후 Client Component로 사용
```javascript
"use client"
import Link from "next/link";
import {useParams} from "next/navigation";

export function Control() {
    const params = useParams();
    return (
        <ul>
            <li><Link href="/create">Create</Link></li>
            <li><Link href="/update/1">Update</Link></li>
            <li><input type="button" value="delete"/></li>
        </ul>
    );
}
```

```javascript
// "use client"; // 서버 컴포넌트에서 사용 불가
import Link from "next/link";
import './globals.css'
import { Control } from './Control';

export const metadata = {
    title: 'Web Tutorial',
    description: 'Generated by cpk78',
}

export default async function RootLayout({children}) {
    const resp = await fetch('http://localhost:9999/topics')
    const topics = await resp.json();
    return (
        <html>
            <body>
            <h1><Link href="/">Web</Link></h1>
            <ol>
                {/*<li><Link href="/read/1">1.html</Link></li>*/}
                {/*<li><Link href="/read/2">2.css</Link></li>*/}
                {topics.map(topic=>{
                    return <li key={topic.id}><Link href={`/read/${topic.id}`}>{topic.title}</Link></li>
                })}
            </ol>
            {children} {/*page.js 내용 표시*/}
            <Control />
            </body>
        </html>
    )
}
```
업데이트와 Delete는 id가 있는 경우만 표시
```javascript
"use client"
import Link from "next/link";
import {useParams, useRouter } from "next/navigation";

export function Control() {
    const params = useParams();
    const id = params.id;
    return (
        <ul>
            <li><Link href="/create">Create</Link></li>
            {id ? <>
                <li><Link href={"/update/"+id}>Update</Link></li>
                <li><input type="button" value="delete"/></li>
            </> : null}
        </ul>
    );
}
```

# 11. Update 기능 구현
